import { printToFileAsync } from "expo-print"; import * as Sharing from "expo-sharing"; import { Platform } from "react-native";
const VERIFY_BASE=process.env.EXPO_PUBLIC_VERIFY_URL||"novatutoring://verify";
export async function generateCertificatePDF({studentName="Student",topic,score,certId,qrData}:{studentName?:string;topic:string;score:number;certId:string;qrData?:string;}){const qr=qrData||`${VERIFY_BASE}/${certId}`;const qrUrl=`https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=${encodeURIComponent(qr)}`;const dateStr=new Date().toLocaleDateString();const html=`<!doctype html><html><head><meta charset="utf-8"/><style>@page{size:A4;margin:24mm}body{font-family:-apple-system,Segoe UI,Roboto,Arial;color:#e7fbff;background:#0c1218}.wrap{border:8px solid #00e5ff;padding:24px;border-radius:16px}.title{text-align:center;font-size:28px;font-weight:800;color:#00e5ff;margin-bottom:8px}.subtitle{text-align:center;font-size:16px;color:#bfe7ef;margin-bottom:24px}.name{text-align:center;font-size:30px;font-weight:900;margin:12px 0;color:#ffd34d}.topic{text-align:center;font-size:22px;font-weight:800;margin:6px 0;color:#74e1ff}.score{text-align:center;font-size:18px;font-weight:700;color:#9cffc8;margin-bottom:22px}.row{display:flex;gap:20px;justify-content:center;align-items:center;margin-top:12px}.qr{border:4px solid #00e5ff;border-radius:12px;padding:8px;background:#071219}.foot{text-align:center;font-size:12px;color:#9db8c0;margin-top:18px}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;color:#bfe7ef}</style></head><body><div class="wrap"><div class="title">Certificate of Achievement</div><div class="subtitle">This certifies that</div><div class="name">${esc(studentName)}</div><div class="subtitle">has successfully completed the quiz on</div><div class="topic">${esc(topic)}</div><div class="score">Final Score: ${score}%</div><div class="row"><div><div style="font-size:12px;color:#9db8c0">Date</div><div style="font-weight:700">${dateStr}</div></div><div><div style="font-size:12px;color:#9db8c0">Certificate ID</div><div class="mono">${certId}</div></div><img class="qr" width="120" height="120" src="${qrUrl}"/></div><div class="foot">Scan to verify â€¢ Nova Tutoring</div></div></body></html>`;const file=await printToFileAsync({html});if(Sharing.isAvailableAsync&&Platform.OS!=="web"){try{await Sharing.shareAsync(file.uri,{dialogTitle:"Share your certificate"})}catch{}}return file.uri;} function esc(s:string){return s.replace(/[&<>"']/g,(c)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' } as any)[c]);}
